#!/bin/bash

# This script replicates the request to create a RunSession.

curl -X POST 'https://papi.test.runwhen.com/api/v3/workspaces/t-online-boutique/runsessions' \
  -H 'Content-Type: application/json' \
  -H 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzQyNzU5MjAzLCJpYXQiOjE3NDAxNjcyMDMsImp0aSI6ImI3NWZhMDU4MTM2NTQ2NWZiYjdmNjJjY2NiODA4YjEyIiwidXNlcl9pZCI6NSwiaXNzIjoidGVzdC5ydW53aGVuLmNvbSJ9.Tm7Grl5pETq1DvBSq7S-I_Dp6GQvbjS_IQChwp0Ig2g' \
  -d '{"generateName": "rubbery-duck", "runRequests": [{"slxName": "t-online-boutique--restart-loadbalancer", "taskTitles": ["Restart Resource with Labels `${LABELS}`", "Get Resource Logs with Labels `${LABELS}`", "Get Current Resource State with Labels `${LABELS}`"], "fromSearchQuery": "Cart service is down", "fromIssue": null}, {"slxName": "t-online-boutique--pagerduty-webhook-handler", "taskTitles": ["Run SLX Tasks with matching PagerDuty Webhook Service ID"], "fromSearchQuery": "Cart service is down", "fromIssue": null}, {"slxName": "t-online-boutique--rc-ob-grnwh-redis-health", "taskTitles": ["Ping `${DEPLOYMENT_NAME}` Redis Workload"], "fromSearchQuery": "Cart service is down", "fromIssue": null}, {"slxName": "t-online-boutique--ob-ob-grnwhnnpr-ngx-ing-gmp", "taskTitles": ["Find Owner and Service Health for Ingress `${INGRESS_OBJECT_NAME}`"], "fromSearchQuery": "Cart service is down", "fromIssue": null}, {"slxName": "t-online-boutique--ob-ob-grnwh-ingress-health", "taskTitles": ["Check for Ingress and Service Conflicts in Namespace `${NAMESPACE}`"], "fromSearchQuery": "Cart service is down", "fromIssue": null}, {"slxName": "t-online-boutique--curl-wolf-papi", "taskTitles": ["${TASK_TITLE}"], "fromSearchQuery": "Cart service is down", "fromIssue": null}, {"slxName": "t-online-boutique--crt-ob-grnwhnnpr-depl-health", "taskTitles": ["Check Deployment Log For Issues with `${DEPLOYMENT_NAME}`"], "fromSearchQuery": "Cart service is down", "fromIssue": null}], "personaShortName": "eager-edgar", "active": true}'
